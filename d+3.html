<!DOCTYPE HTML>
<html>
<head><title>jAmeba3</title></head>
<body/>
<script type="text/javascript" src="spectrum128.js"></script>
<script type="text/javascript" src="spec128s1.js"></script>
<script type="text/javascript" src="spectrum3f.js"></script>
<script type="text/javascript" src="fdc.js"></script>
<script type="text/javascript" src="ay.js"></script>
<script type="text/javascript" src="z80.php?m=1&p=1"></script>
<script type="text/javascript">ie=0</script>
<!--[if IE]>
<script type="text/javascript">ie=1;onhelp=function(){return false}</script>
<script type="text/vbscript" src="ie.vbscript"></script>
<![endif]-->
<script type="text/javascript">
pb= []; // playback
pbf=pbt=frc=game=t=u=0;
function cb(b,c){
  if( c=='m' )
    emul=b;
  else
    game=b;
  if( c==8 )
    document.write(game);
  else if(!t--){
    document.body.style.margin= 0;
    pt= document.createElement('select');
    pt.setAttribute('onchange','tapep=this.value;tapei=this.selectedIndex');
    cu= document.createElement('div');
    cu.setAttribute('style','overflow-y:auto;background:#fff;opacity:0.9;padding:0 5px');
    dv= document.createElement('div');
    dv.setAttribute('style','display:none;position:absolute');
    dv.appendChild(pt);
    dv.appendChild(cu);
    he= document.createElement('canvas');
    he.width= 512;
    he.height= 384;
    he.setAttribute('style','display:none;position:absolute');
    eld= (elm= (ct= he.getContext('2d')).getImageData(0,0,512,384)).data;
    ir= document.createElement('iframe');
    ir.setAttribute('style','display:none');
    document.body.appendChild(ir);
    while(t<98303)
      a= emul.charCodeAt(++t+24) >> 4,
      eld[u++]= emul.charCodeAt(3*a),
      eld[u++]= emul.charCodeAt(3*a+1),
      eld[u++]= emul.charCodeAt(3*a+2),
      eld[u++]= a ? 255 : 55,
      a= emul.charCodeAt(t+24) & 15,
      eld[u++]= emul.charCodeAt(3*a),
      eld[u++]= emul.charCodeAt(3*a+1),
      eld[u++]= emul.charCodeAt(3*a+2),
      eld[u++]= a ? 255 : 55;
    ct.putImageData(elm, 0, 0);
    cv= document.createElement('canvas');
    cv.width= 256;
    cv.height= 192;
    document.body.appendChild(cv);
    document.body.appendChild(he);
    document.body.appendChild(dv);
    eld= (elm= (ct= cv.getContext('2d')).getImageData(0,0,256,192)).data;
    init();
  }
  else if ( c=='c' ){ // rec c
    k=b.indexOf('\0');
    ci=b.length;
    frc=bp=k+1;
    while(bp<ci)
      pbf+= (ap= b.charCodeAt(--ci)),
      ap != 255 && bp++;
    while(ci<b.length)
      ap=b.charCodeAt(ci++),
      pb[pbt++]= ap==255 ? ap : ap | b.charCodeAt(frc++)<<8;
    frc= pb[0]&255;
    ajax((b[k-1]==0?'snaps/':'games/')+(param=b.substr(0, k)));
  }
}
function ajax(f,g){
  var xhr=new XMLHttpRequest();
  if( g<0 )
    xhr.onreadystatechange=function(){
      if(xhr&&xhr.readyState==4)
        rt(ie ? bin2arr(xhr.responseBody) : bin2str(xhr.responseText));
      };
  else
    xhr.onreadystatechange=function(){
      if(xhr&&xhr.readyState==4)
        cb(ie ? bin2arr(xhr.responseBody) : bin2str(xhr.responseText), xhr.getResponseHeader('Content-Type').slice(-1));
      };
  xhr.open('POST',f,true);
  if (!ie)
    xhr.overrideMimeType('text/plain;charset=x-user-defined');
  xhr.send(g);
}
function bin2str(a) {
  return a.replace(/[\s\S]/g,function(t){
    return String.fromCharCode(t.charCodeAt(0)&0xff);
  });
}
function bin2arr(a) {
  return arr(a).replace(/[\s\S]/g,function(t){
    v= t.charCodeAt(0);
    return String.fromCharCode(v&0xff, v>>8);
  }) + arrl(a);
}
k=location.href.indexOf('?')+1;
ifra=location.href.slice(-1)=='#';
if(k)
  params=param=location.href.substr(k,location.href.length-k-ifra),
  t++,
  ajax((param.slice(-1)=='c'
    ? (t++,'recorded/')
    : (param.slice(-1)==0?'snaps/':'games/'))+param);
ajax('_+3');
</script>
</html>